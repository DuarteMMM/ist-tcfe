\section{Simulation Analysis}
\label{sec:simulation}

\subsection{Exercise 1} \label{sec:Ex1Sim}

Table \ref{tab:Exercise1Both} shows the simulated operating point results for the circuit presented in Figure \ref{fig:CircuitDraw}. Again, currents designated below as $I_i$ refer to the currents passing through the respective resistances, $R_i$.


\begin{table}[H]
  \centering
  \begin{tabular}{cc}
    \begin{tabular}{|c|c|}
      \hline
      \multicolumn{2}{|c|}{\bf \color{blue} Theoretical} \\
      \hline
          {\bf Designation} & {\bf Value [A or V]} \\ \hline
          \input{Exercise1.tex}
    \end{tabular}
    \qquad
    \begin{tabular}{|c|c|}
      \hline
      \multicolumn{2}{|c|}{\bf \color{blue} Simulation} \\
      \hline    
          {\bf Designation} & {\bf Value [A or V]} \\ \hline
          \input{../sim/Exercise1_tab.tex}
    \end{tabular}
  \end{tabular}
  \caption{Exercise 1 - comparison between theoretical analysis and operating point analysis's results. Currents $I_i$ are in amperes; voltages $V_i$ are in volts.}
  \label{tab:Exercise1Both}
\end{table}

Comparing the results, we can notice almost no differences. This was to be expected, since the circuit has no time dependency - meaning it's equal at any point in time. There is only a small difference between the two values of $I_c$, although it is negligible.

\subsection{Exercise 2} \label{sec:Ex2Sim}

Now we can approach the second point of our simulation where we see how the system behaves when $v_s(0)=0$ and the capacitor is replaced by a voltage souce $V_X$=V(6)-V(8), where the voltages are taken from the simulation column of Table~\ref{tab:Exercise1Both}.
% ALT_J
We use this method since we want to start by determining the natural solution of the system.

\begin{table}[H]
  \centering
  \begin{tabular}{cc}
    \begin{tabular}{|c|c|}
      \hline
      \multicolumn{2}{|c|}{\bf \color{blue} Theoretical} \\
      \hline
          {\bf Designation} & {\bf Value [A or V]} \\ \hline
          \input{Exercise2.tex}
    \end{tabular}
    \qquad
    \begin{tabular}{|c|c|}
      \hline
      \multicolumn{2}{|c|}{\bf \color{blue} Simulation} \\
      \hline    
          {\bf Designation} & {\bf Value [A or V]} \\ \hline
          \input{../sim/Exercise2_tab.tex}
    \end{tabular}

  \end{tabular}
  \caption{Exercise 2 comparison. Operating point analysis table. Currents $I_i$ are in amperes; voltages $V_i$ are in volts.}
  \label{tab:Exercise2Both}
\end{table}

From Table~\ref{tab:Exercise2Both} we want the values of potential in nodes v6 and v8 which are their values when t=0. This means that we now have everything we need (initial conditions) to determine the natural solution of the system for $t>0$, which is what we will do next.


\subsection{Exercise 3} \label{sec:Ex3Sim}

Now we do a transient analisis of the values. Figure~\ref{fig:Ex3_Image} shows the simulated transient analysis results obtained for the voltage in node 6, when $V_s$ is still at 0V. This represents the discharge of the capacitor threw the system, meaning the natural solution.
\vspace{-30mm}
\begin{figure}[H]
  \centering
  \small
  \includegraphics[width=0.5\linewidth]{../sim/ex3_image.pdf}
  \caption{Natural response - value of $v_6(t)$ in the time interval [0,20] ms.}
  \label{fig:Ex3_Image}
\end{figure}

As we can see the solution is an exponential as theory tells us and very similar to the solution in the Theoretical section. We can also clearly see the inicial voltage in the beggining of the graph, which is the one calculated in Exercise 2 confirming that simulation is indeed correct.

\subsection{Exercise 4} \label{sec:Ex4Sim}

Having known the inicial conditions and how the system behaves naturally we now add the equation $v_s(t)=sin(2 \pi f t)$ (true for $t>0$) for $v_s$. We now analise the circuit exactly as represented in Figure \ref{fig:CircuitDraw}, having the natural solution added to the forced solution.\par
In Figure \ref{fig:Ex4_Image} we can see two nodes represented. Node 6 where we observe the natural and forced solutions together and how that afects it's potential over time ( the response) and the stimulus in node 1 since $V_s$ is the one responsible for the forced solution. For this particular analisis f=1kHz and all the other values used where taken from the previous sections. 

\begin{figure}[H]
  \centering
  \includegraphics[width=0.6\linewidth]{../sim/ex4_image.pdf}
  \caption{Forced sinusoidal response and stimulus on node 6 in time interval [0,20] ms.}
  \label{fig:Ex4_Image}
\end{figure}


As expected the graph obtained is the sum of an exponential and ans cos() function which correlates with theoretical results and the graph obtained in Figure~\ref{fig:final} as they are identical.

\subsection{Exercise 5} \label{sec:Ex5Sim}

In this last section the frequency analysis was performed on the circuit of figure \ref{fig:CircuitDraw} from f=0.1Hz to f=1MHz. In figures \ref{fig:Ex5_Image_Magnitude} and \ref{fig:Ex5_Image_Phase} we present the results obtained for the relevant nodes (and their diferences obtaining $V_c$ and $V_s$).
 \begin{figure}[H]
 \footnotesize
\begin{subfigure}{.49\linewidth}
 \footnotesize
  \centering
  % include first image
  \includegraphics[width=1.\linewidth]{../sim/ex5_image_magnitude.pdf}
   \footnotesize
\caption{Frequency analysis - magnitudes of $v_6(f)$, $v_s(f)$ and $v_c(f)=v_6(f)-v_8(f)$ in interval f=[0.1,10e+6] Hz and in dB.}
\label{fig:Ex5_Image_Magnitude}
\end{subfigure}
\hspace{5mm}
\begin{subfigure}{.49\linewidth}
  \centering
  % include second image
  \includegraphics[width=1.\linewidth]{../sim/ex5_image_phase.pdf}  
\caption{Frequency analysis - phases of $v_6(f)$, $v_s(f)$ and $v_c(f)=v_6(f)-v_8(f)$ in interval f=[0.1,10e+6] Hz and in degrees.}
\label{fig:Ex5_Image_Phase}
\end{subfigure}
\end{figure} 

Firstly in figure \ref{fig:Ex5_Image_Magnitude} we observe what was predicted by the theoretical solutions in class, since $V_c$ is inversely proportional to the frequency and so when it increases, $V_c$  tends to 0 meaning $-\infty$ dB.The phase is also explained by limit of a atan() function meaning 90ยบ. We can see as predicted that $V_s$(V1) is constant and it differs from V6 since this node is not frequency independent. We obtain this result since $V_s$ is not dependent on the capacitor and so it's magnitude and phase do not differ over an increase of frequency. In contrast, V6 depends on the capacitor and thus it behaves accordingly which in turn means that it is frequency dependent. As observed for lower frequencies meaning high impedance on the capacitor it behaves similarly as in a DC circuit, which results in a constant amplitude and phase. When $\omega^2R_{eq}^2C^2$ gets bigger and closer to values comparable to 1, we observe a shift in behaviour, as we start noticing V6's dependence on the capacitor and so the frequency. When we aproach high frequencies meaning low impeadence in the capacitor it starts behaving as a short circuit and so V6 tends to the amplitude of V8 and it's phase shifts accordingly, 180ยบ.   
