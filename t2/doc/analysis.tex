\section{Theoretical Analysis}
\label{sec:analysis}

\subsection{Exercise 1}

In this section, the circuit shown in Figure~\ref{fig:CircuitDraw} is analysed theoretically for $t<0$, by using the node method. The Kirchhoff Current Law (KCL) states that the sum of the currents converging or diverging in a node is null. The nodes considered for the following equations are those represented in Figure~\ref{fig:CircuitDraw}. Using KCL and Ohm's Law (which can also be written as $I=VG$) in nodes not connected to voltage sources and additional equations for nodes related by voltage sources, it is possible to obtain a linear system from which the voltages at nodes $V_1$ to $V_8$ and currents in resistances $R_1$ to $R_7$ can be determined.

\par
It is worth mentioning that 

\par
\vspace{1mm}

The following linear system is obtained:

\begin{equation}
  \begin{pmatrix}
    1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
    -\frac{1}{R_1} & \frac{1}{R_1}+\frac{1}{R_2}+\frac{1}{R_3} & -\frac{1}{R_2} & 0 & -\frac{1}{R_3} & 0 & 0 & 0 \\
    0 & -K_b-\frac{1}{R_2} & \frac{1}{R_2} & 0 & K_b & 0 & 0 & 0 \\
    0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 \\
    0 & -\frac{1}{R_3} & 0 & -\frac{1}{R_4} & \frac{1}{R_3}+\frac{1}{R_4}+\frac{1}{R_5} & -\frac{1}{R_5} & -\frac{1}{R_7} & \frac{1}{R_7} \\
    0 & K_b & 0 & 0 & -\frac{1}{R_5}-K_b & \frac{1}{R_5} & 0 & 0 \\
    0 & 0 & 0 & 0 & 0 & 0 & \frac{1}{R_6}+\frac{1}{R_7} & -\frac{1}{R_7} \\
    0 & 0 & 0 & -\frac{K_d}{R_6} & 1 & 0 & \frac{K_d}{R_6} & -1
  \end{pmatrix}
  \begin{pmatrix}
    V_1  \\
    V_2  \\
    V_3  \\
    V_4  \\
    V_5  \\
    V_6  \\
    V_7  \\
    V_8  \\
  \end{pmatrix}
  =
  \begin{pmatrix}
    V_s \\
    0   \\
    0   \\
    0   \\
    0   \\
    0   \\
    0   \\
    0   \\
  \end{pmatrix}
  \label{eq:Exercise1LinearSystem}
\end{equation}

By solving the linear system~\ref{eq:Exercise1LinearSystem}, the values for node voltages and branch currents (calculated by using Ohm's Law) are obtained. These values, as well as the currents passing through voltage sources and currents $I_c$ and $I_b$, are shown in Table \ref{tab:Exercise1Theoretical}.

\begin{table}[H]
  \centering
  \begin{tabular}{|c|c|}
    \hline
        {\bf Designation} & {\bf Value [A or V]} \\ \hline
        \input{Exercise1.tex}
  \end{tabular}
  \caption{Values of node voltages (in volts) and currents (in amperes). Current $I_i$ corresponds to the current passing through resistance $R_i$.}
  \label{tab:Exercise1Theoretical}
\end{table}


\subsection{Exercise 2}
In this exercise we are going to analise the system also using the node method, as explained before. In this case our goal is to the get the $R_{eq}$, which means, to find the value of the resistance for the Norton and ThÃ©venin equivalents. In order to calculate the resistance one must turn off all the constant sources, so, as we want to find the equivalent seen from the capacitor, we must have $V_S=0$. That's the reason, why we do that. Now we are going to use the nodal method to determine the current going to the capacitor if we put a current source wi3th its voltage in its place and then, as we know the current and the voltage, one can simply use the Ohm's law:
\begin{equation}
  R=\frac{V}{I}
\end{equation}
We can use almost all the matrix in the previous exercise. The only differences are the ones stated in the previous paragraph. As we have already determined the voltages in the nodes before, we obtain the matrix above to get the voltages in the nodes,definig $V_x$ as the value of $V_6-V_8$,and knowing that $V_4=0$, we already symplified a little in order to make the implementation easier:
\begin{equation}
  \begin{pmatrix}
    1 & 0 & 0 & -1 & 0 & 0 & 0 & 0 \\
    -\frac{1}{R_1} & \frac{1}{R_1}+\frac{1}{R_2}+\frac{1}{R_3} & -\frac{1}{R_2} & 0 & -\frac{1}{R_3} & 0 & 0 & 0 \\
    0 & -K_b-\frac{1}{R_2} & \frac{1}{R_2} & 0 & K_b & 0 & 0 & 0 \\
    0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 \\
    0 & K_b-\frac{1}{R_3} & 0 & -\frac{1}{R_4} & \frac{1}{R_3}+\frac{1}{R_4}-K_b & 0 & -\frac{1}{R_7} & \frac{1}{R_7} \\
    0 & 0 & 0 & 0 & 0 & 1 & 0 & -1 \\
    0 & 0 & 0 & 0 & 0 & 0 & 0 & \frac{1}{R_6}+\frac{1}{R_7} \\
    0 & 0 & 0 & 0 & 0 & 1 & 0 & -\frac{K_d}{R_6} \\
  \end{pmatrix}
  \begin{pmatrix}
    V_1  \\
    V_2  \\
    V_3  \\
    V_4  \\
    V_5  \\
    V_6  \\
    V_7  \\
    V_8  \\
  \end{pmatrix}
  =
  \begin{pmatrix}
     \\
    0   \\
    0   \\
    0   \\
    0   \\
    V_x  \\
    0   \\
    0   \\
  \end{pmatrix}
  \label{eq:Exercise1LinearSystem}
\end{equation}

\begin{table}[H]
  \centering
  \begin{tabular}{|c|c|}
    \hline
        {\bf Designation} & {\bf Value [A or V]} \\ \hline
        \input{Exercise2.tex}
  \end{tabular}
  \caption{Values of node voltages (in volts) and branch currents (in amperes). Current $I_i$ corresponds to the current passing through resistance $R_i$.}
  \label{tab:Exercise2Theoretical}
\end{table}
Now that we have all this values, we are simply going to calculate the current going throw the capacitor/voltage source as the different between the current going throw $R_5$ and the current $I_b$, finally getting the result we want. We state that the current is flowing in the oposite direction of what it was suppose to flow, so, the equivalent resistance is the symetric of the result:
\begin{table}[H]
  \centering
  \begin{tabular}{|c|c|}
    \hline
        {\bf Designation} & {\bf Value [A or V]} \\ \hline
        \input{Exercise2.1.tex}
  \end{tabular}
  \caption{Values of node voltages (in volts) and branch currents (in amperes). Current $I_i$ corresponds to the current passing through resistance $R_i$.}
  \label{tab:Exercise2.1Theoretical}
\end{table}

\subsection{Exercise 3}
Using the results from the previous exercise we understand we can simplify the circuit into a circuit with a voltage source, a resistance and and the capacitor. For this case we already have that the natural solution looks like:
\begin{equation}
  v_n(t)=A \times e^{-\frac{t}{RC}}
  \end{equation}
Where A is the value in $t=0$ acording to the previous exercise, $t$ stands for time, $R$ for the equivalent resistance and $C$ for the capacitance of the capacitor. Plotting the result one gets:
\begin{figure}[h] \centering
\includegraphics[width=0.8\linewidth]{natural.eps}
\caption{Natural response}
\label{fig:natural}
\end{figure}


\subsection{Exercise 4}
In this exercise we are going to determine the forced solution of the equation, in order to get the final solution ading the natural solution tot he forced solution. We first define $V_s$ as 1. As the whole system is linear, so the response should be. Therefore if we aplly the voltage $V_s=1$ we get the response of the system for one Volt, then we only have to multiply the voltages by the real $V_s$ in order to get the real voltages.
Then we get the matrix:
\begin{equation}
  \begin{pmatrix}
    1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
    -\frac{1}{R_1} & \frac{1}{R_1}+\frac{1}{R_2}+\frac{1}{R_3} & -\frac{1}{R_2} & 0 & -\frac{1}{R_3} & 0 & 0 & 0 \\
    0 & -K_b-\frac{1}{R_2} & \frac{1}{R_2} & 0 & K_b & 0 & 0 & 0 \\
    0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 \\
    0 & -\frac{1}{R_3} & 0 & 0 & \frac{1}{R_3}+\frac{1}{R_4}-\frac{1}{R_5}  & -\frac{1}{R_5}-jwC & -\frac{1}{R_7}n & \frac{1}{R_7}+jwC \\
    0 & K_b & 0 & 0 & -K_b-\frac{1}{R_5} & \frac{1}{R_5}+jwC & 0 & -jwC \\
    0 & 0 & 0 & 0 & 0 & 0 & \frac{1}{R_6}+\frac{1}{R_7} & -\frac{1}{R_7} \\
    0 & 0 & 0 & 0 & 1 & 0 & \frac{K_d}{R_6} & -1 \\
  \end{pmatrix}
  \begin{pmatrix}
    V_1  \\
    V_2  \\
    V_3  \\
    V_4  \\
    V_5  \\
    V_6  \\
    V_7  \\
    V_8  \\
  \end{pmatrix}
  =
  \begin{pmatrix}
    Vs  \\
    0   \\
    0   \\
    0   \\
    0   \\
    0  \\
    0   \\
    0   \\
  \end{pmatrix}
  \label{eq:Exercise4LinearSystem}
\end{equation}

And results are:

\begin{table}[H]
  \centering
  \begin{tabular}{|c|c|}
    \hline
        {\bf Designation} & {\bf Value [A or V]} \\ \hline
        \input{Exercise4.tex}
  \end{tabular}
  \caption{Values of node complex amplitude (in volts).}
  \label{tab:Exercise2Theoretical}
\end{table}

\subsection{Exercise 5}
In this exercise we are going to plot the sum of the results of the 2 previous exercises. We obtain the following plot:


\begin{figure}[h] \centering
\includegraphics[width=0.8\linewidth]{finaloct2.eps}
\caption{Final solution[-5;0]ms}
\label{fig:finaloct}
\end{figure}
\begin{figure}[h] \centering
\includegraphics[width=0.8\linewidth]{finaloct.eps}
\caption{Final solution[0;20]ms}
\label{fig:finaloct}
\end{figure}

We see that $V_6$ is not a continuous function, but it should not be, as the voltage source doesn't have a continuous function for the source. Yet, we notice that the voltage in the capacitor is continuous, which is, in fact, the only thing that matters to make our system possible.


\subsection{Exercise 6}
In this exercise as we only want to compare the magnitudes and the phases of $V_s$,$V_6$ and $V_c$ for each of the different frequencies. The results are shown in the plots below:
\begin{figure}[h] \centering
\includegraphics[width=0.8\linewidth]{dBoct.eps}
\caption{Magnitude of nodes}
\label{fig:finaloct}
\end{figure}

\begin{figure}[h] \centering
\includegraphics[width=0.8\linewidth]{phaseoct.eps}
\caption{Phase of nodes}
\label{fig:finaloct}
\end{figure}

